# File Combiner App

Это веб-приложение для объединения содержимого текстовых файлов в один документ. Оно состоит из двух частей:

1.  **Бэкенд (FastAPI)**: REST API, реализующий логику объединения файлов.
2.  **Фронтенд (Streamlit)**: Веб-интерфейс для взаимодействия с пользователем.

## Документация

Полная документация проекта доступна в директории [`docs/`](docs/):

*   **[Главная (Обзор, Быстрый старт)](docs/index.md)**
*   **[Установка](docs/installation.md)**
*   **[Использование](docs/usage.md)**
*   **[API бэкенда](docs/api.md)**
*   **[Разработка](docs/development.md)**
*   **[Внесение вклада](docs/contributing.md)**

## Структура проекта

```
.
├── backend/
│   ├── src/
│   │   ├── backend/
│   │   │   ├── __init__.py
│   │   │   └── main.py          # Основной файл FastAPI приложения
│   │   ├── shared/
│   │   │   ├── __init__.py
│   │   │   └── combine_logic.py # Общая логика объединения файлов
│   │   └── __init__.py
│   ├── pyproject.toml           # Зависимости и метаданные бэкенда
│   └── uv.lock                  # Заблокированные зависимости
├── frontend/
│   ├── app.py                   # Основной файл Streamlit приложения
│   ├── pyproject.toml           # Зависимости и метаданные фронтенда
│   └── uv.lock                  # Заблокированные зависимости
├── tests/
│   ├── backend/
│   │   ├── __init__.py
│   │   └── test_main.py         # Тесты для FastAPI endpoints
│   ├── shared/
│   │   ├── __init__.py
│   │   └── test_combine_logic.py # Тесты для общей логики
│   └── __init__.py
├── scripts/
│   └── development/
│       ├── README.md            # Документация для скриптов
│       ├── run_app.bat          # Запуск обоих сервисов (Windows)
│       ├── run_app.sh           # Запуск обоих сервисов (Unix/Linux/macOS)
│       ├── run_backend.bat      # Запуск backend сервиса (Windows)
│       ├── run_frontend.bat     # Запуск frontend сервиса (Windows)
│       ├── run_tests.bat        # Запуск тестов (Windows)
│       └── run_tests.sh         # Запуск тестов (Unix/Linux/macOS)
├── docs/                        # Документация
├── .github/workflows/           # GitHub Actions CI/CD
├── .pre-commit-config.yaml      # Конфигурация pre-commit хуков
├── docker-compose.yml           # Конфигурация Docker Compose
├── CONTRIBUTING.md              # Руководство по внесению вклада
└── README.md                    # Этот файл
```
*Примечание: Файлы `requirements.txt` были удалены в пользу `pyproject.toml` для управления зависимостями с помощью `uv`.*

## Установка и запуск с помощью `uv`

### Предварительные требования

*   Установленный [`uv`](https://github.com/astral-sh/uv) (менеджер пакетов и виртуальных сред Python от Astral).

### 1. (Опционально) Создание виртуальных сред

`uv` автоматически управляет виртуальными средами, но вы можете явно создать их:

```bash
# Создание виртуальной среды для бэкенда
uv venv backend/.venv
# Создание виртуальной среды для фронтенда
uv venv frontend/.venv
```

`uv` будет использовать эти среды, если они существуют, или создаст новые при необходимости.

### 2. Установка зависимостей

`uv` автоматически установит зависимости при первом запуске скриптов или при вызове `uv run`. Однако вы можете сделать это явно:

```bash
# Установка зависимостей для бэкенда
cd backend
uv sync
cd ..

# Установка зависимостей для фронтенда
cd frontend
uv sync
cd ..
```

### 3. (Опционально) Установка и запуск `pre-commit` хуков

Для обеспечения качества кода проект использует `pre-commit` хуки, которые автоматически запускают `ruff` (линтер и форматтер) и `mypy` (статический анализатор типов) перед каждым коммитом.

#### Установка хуков

1.  Убедитесь, что зависимости установлены (шаг 2).
2.  Выполните команду из корня проекта:
    ```bash
    cd backend
    uv run pre-commit install
    cd ..
    ```
    Это установит хуки в ваш локальный репозиторий Git.

#### Ручной запуск хуков

Вы можете вручную запустить хуки на всех файлах проекта:
```bash
cd backend
uv run pre-commit run --all-files
cd ..
```

### 4. Запуск приложения

#### Вариант 1: Использование универсального скрипта

*   **Windows:** Дважды кликните `scripts/development/run_app.bat` или запустите его из командной строки.
*   **Unix/Linux/macOS:** Запустите `./scripts/development/run_app.sh` из терминала.

Откроется интерактивное меню, позволяющее выбрать, какой компонент запустить (бэкенд, фронтенд, или оба сразу).

#### Вариант 2: Ручной запуск с `uv`

*   **Запуск бэкенда:**
    ```bash
    cd backend
    uv run uvicorn src.backend.main:app --reload --host 0.0.0.0 --port 8000
    ```
    Сервер будет доступен по адресу `http://localhost:8000`. Вы можете открыть `http://localhost:8000/docs` для просмотра автоматической документации API.

*   **Запуск фронтенда:**
    ```bash
    cd frontend
    uv run streamlit run app.py
    ```
    Streamlit автоматически откроет браузер с адресом приложения (обычно `http://localhost:8501`).

**ВАЖНО:** Бэкенд должен быть запущен до или одновременно с фронтендом для корректной работы приложения.

## Тестирование

Проект включает unit-тесты и интеграционные тесты для проверки корректности работы.

### Запуск тестов

#### Вариант 1: Использование скрипта

*   **Windows:** Дважды кликните `scripts/development/run_tests.bat` или запустите его из командной строки.
*   **Unix/Linux/macOS:** Запустите `./scripts/development/run_tests.sh` из терминала.

#### Вариант 2: Ручной запуск с `uv`

*   Тесты запускаются из окружения бэкенда, так как именно там установлен `pytest`.
    ```bash
    cd backend
    uv run pytest ../tests -v
    cd ..
    ```

### Покрытие кода (Coverage)

Для генерации отчета о покрытии кода тестами можно использовать `pytest-cov`:

```bash
cd backend
uv run pytest ../tests --cov=../backend/src --cov-report=html
cd ..
```
Это создаст HTML-отчет в директории `htmlcov/`.

## Запуск с помощью Docker

Этот проект также можно запустить с использованием Docker и Docker Compose, что упрощает развертывание, особенно на серверах.

### Предварительные требования

*   Установленный [Docker](https://docs.docker.com/get-docker/)
*   Установленный [Docker Compose](https://docs.docker.com/compose/install/)

### Сборка и запуск

1.  **Сборка образов:**
    Из корневой директории проекта выполните:
    ```bash
    docker-compose build
    ```

2.  **Запуск сервисов:**
    ```bash
    docker-compose up
    ```
    Или для запуска в фоновом режиме (detached):
    ```bash
    docker-compose up -d
    ```

3.  **Доступ к приложению:**
    *   Фронтенд Streamlit будет доступен по адресу: `http://localhost:8501`
    *   Бэкенд FastAPI API будет доступен по адресу: `http://localhost:8000`
    *   Документация API (Swagger UI): `http://localhost:8000/docs`

4.  **Остановка сервисов:**
    ```bash
    docker-compose down
    ```

### Конфигурация

*   **Порты:** Порты `8000` (бэкенд) и `8501` (фронтенд) можно изменить в файле `docker-compose.yml`.
*   **Переменные окружения:** В `docker-compose.yml` определены переменные окружения, которые можно изменить под свои нужды.

## Использование

1.  Откройте в браузере интерфейс фронтенда (`http://localhost:8501`).
2.  Выберите тип ввода:
    *   **Загрузить файлы:** Выберите отдельные файлы для объединения.
    *   **Выбрать папку:** Укажите путь к папке для объединения всех файлов в ней.
3.  При выборе папки:
    *   Укажите путь к папке в поле ввода.
    *   (Опционально) Введите фильтр по расширениям файлов.
    *   (Опционально) Укажите глубину обработки папок (0 для неограниченной глубины).
4.  В разделе "2. Настройте параметры" выберите способ сортировки и, при необходимости, введите фильтр по расширениям.
5.  Нажмите кнопку "🚀 Объединить файлы".
6.  Результат отобразится в разделе "4. Результат". Вы можете скопировать его или скачать с помощью кнопки "💾 Скачать результат (Markdown)".

## Функциональность

*   **Загрузка файлов:** Поддерживает множественную загрузку файлов различных типов.
*   **Обработка папок:** Возможность выбрать entire папку для объединения всех файлов в ней.
*   **Рекурсивная обработка папок:** Поддержка обработки вложенных папок с контролем глубины.
*   **Сортировка:** Файлы можно сортировать по имени или дате последнего изменения.
*   **Фильтрация:** Возможность фильтровать файлы по указанным расширениям.
*   **Объединение:** Содержимое файлов объединяется в один документ.
*   **Несколько форматов вывода:** Поддержка Markdown, JSON и YAML.
*   **Предварительная обработка:** Опции для очистки содержимого файлов:
    *   Удаление лишних пустых строк
    *   Нормализация окончаний строк
    *   Удаление пробельных символов в конце строк
*   **Скачивание:** Результат можно скачать в виде файла.
*   **Визуализация структуры папок:** В JSON и YAML форматах отображается структура папок для лучшего понимания организации файлов.

## Качество кода и поддержка

Проект следует современным практикам разработки Python:

*   **Структура кода:** Использует `src/` layout для четкого разделения кода и тестов
*   **Управление зависимостями:** Использует `uv` и `pyproject.toml` для эффективного управления зависимостями
*   **Контроль качества:** Автоматизированные проверки кода с помощью `ruff` и `mypy`
*   **Тестирование:** Комплексное тестирование с использованием `pytest`
*   **Документация:** Подробная документация для разработчиков и пользователей