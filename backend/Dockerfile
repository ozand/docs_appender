# Используем официальный образ Python с slim-версией
FROM python:3.11-slim

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Копируем файлы зависимостей
COPY pyproject.toml uv.lock* ./

# Устанавливаем uv (если он еще не установлен) и зависимости
# Используем pip для установки uv, так как он может не быть в slim-образе
RUN pip install uv && uv sync --frozen

# Копируем остальные файлы приложения
COPY . .

# Открываем порт, который будет использовать приложение
EXPOSE 8000

# Команда для запуска приложения
# Используем gunicorn для более надежного запуска в production
# --workers 1 для простоты, можно увеличить
# Обновляем путь к main.py из-за новой структуры директорий
CMD ["uv", "run", "gunicorn", "-w", "1", "-k", "uvicorn.workers.UvicornWorker", "src.backend.main:app", "--bind", "0.0.0.0:8000"]